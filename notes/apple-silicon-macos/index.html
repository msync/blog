<!DOCTYPE html>
<html lang="en-us"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">Quick Notes - Hardware-aware programming on MacOS | M&#39;Sync</title>
<meta property="og:title" content="Quick Notes - Hardware-aware programming on MacOS | M&#39;Sync" />
<meta name="twitter:title" content="Quick Notes - Hardware-aware programming on MacOS | M&#39;Sync" />
<meta itemprop="name" content="Quick Notes - Hardware-aware programming on MacOS | M&#39;Sync" />
<meta name="application-name" content="Quick Notes - Hardware-aware programming on MacOS | M&#39;Sync" />
<meta property="og:site_name" content="M&#39;Sync" />

<meta name="description" content="Knowledge garden with notes and computational content">
<meta itemprop="description" content="Knowledge garden with notes and computational content" />
<meta property="og:description" content="Knowledge garden with notes and computational content" />
<meta name="twitter:description" content="Knowledge garden with notes and computational content" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />

  <link rel="alternate" hreflang="en" href="https://example.org/notes/apple-silicon-macos/" title="" />






<meta name="generator" content="Hugo 0.150.0">

    
    <meta property="og:url" content="https://example.org/notes/apple-silicon-macos/">
  <meta property="og:site_name" content="M&#39;Sync">
  <meta property="og:title" content="Quick Notes - Hardware-aware programming on MacOS">
  <meta property="og:description" content="Short notes - pointers to programming for speed and efficiency, leveraging hardware-specific features available on ARM Apple Silicon. MacOS-focused at most places, although ideas are easy to generalise.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="notes">
    <meta property="article:published_time" content="2024-06-29T09:32:47+05:30">
    <meta property="article:modified_time" content="2024-07-08T21:59:56+05:30">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Quick Notes - Hardware-aware programming on MacOS">
  <meta name="twitter:description" content="Short notes - pointers to programming for speed and efficiency, leveraging hardware-specific features available on ARM Apple Silicon. MacOS-focused at most places, although ideas are easy to generalise.">


    

    <link rel="canonical" href="https://example.org/notes/apple-silicon-macos/">
    <link href="/style.min.8e72eaf30242279b90867e29e1caad29da8705d884235124f205cdaf7cf82fa4.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="https://example.org/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
    
      


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">


<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
    
</head>
<body data-theme = "light" class="notransition">

<script src="/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js" integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="https://example.org/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title></title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/notes/">
                        Notes
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/blog/">
                        Blog
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">Quick Notes - Hardware-aware programming on MacOS</h1>
                
                
                
                <div class="post-meta">
                    <time datetime="2024-06-29T09:32:47&#43;05:30" itemprop="datePublished"> Jun 29, 2024 </time>
                </div>
                
            </header>
            
            <div class="page-content">
                
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Purpose
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>The purpose of this document is to help with a quick overview and reference for developers on the Apple platform who&#39;d like to be aware of what facilities are available for optimal utilisation of their hardware, in the current context of an upcoming AI-focused tech world where parallel processing is a fundamental need. The ideas are general and developers will be able to map these to other platforms, and know what to look for in general when faced with unknowns.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Key Terms and Techniques
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
<a href="https://en.wikipedia.org/wiki/Single_instruction,_multiple_data">SIMD</a> - Single Instruction, Multiple Data
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>
SIMD allows for working on more data in lesser number of CPU cycles, by optimally using the available registers (typically, under-utilised) and the bandwidth between the CPU and memory (again, typically under-utilised). Recall that moving data around is counted as <a href="https://en.wikipedia.org/wiki/Input/output">IO</a>, which is generally orders of magnitude slower than compute.</p>
<p>
It&#39;s useful here to quote Wikipedia</p>
<div class="aside-block">
<p>Single instruction, multiple data (SIMD) is a type of parallel processing in <a href="https://en.wikipedia.org/wiki/Flynn%27s_taxonomy">Flynn&#39;s taxonomy</a>.
SIMD can be internal (part of the hardware design) and it can be directly accessible through an instruction set architecture (ISA), but it should not be confused with an ISA. SIMD describes computers with multiple processing elements that perform the same operation on multiple data points simultaneously.</p>
</div>
<div id="outline-container-headline-4" class="outline-5">
<h5 id="headline-4">
<a href="https://developer.arm.com/Architectures/Neon">ARM NEON</a>
</h5>
<div id="outline-text-headline-4" class="outline-text-5">
<p>Single Instruction Multiple Data (SIMD) architecture extension for the A-profile and R-profile processors. Neon extends the basic SIMD instruction set to cover wider-width values (like 64- and 128-bit values)
Note: NEON is a trademark associated with ARM, not Apple. Apple Silicon uses the ARM architecture - which they are licensed to use. Knowing NEON is useful beyond the Apple ecosystem on the ARM platform.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
<a href="https://developer.apple.com/metal/">Metal</a>
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<p>Metal is a low-level graphics API that is useful for general-purpose GPU programming - <strong>GPGPU</strong>. This is Apple-specific.</p>
</div>
</div>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
<a href="https://developer.apple.com/documentation/accelerate">Accelerate</a>
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<p>
Acclerate is <strong>not</strong> related to the GPU. It provides a unified computing framework for various devices in the Apple ecosystem, leveraging the hardware as efficiently as possible, including hardware-specific SIMD instructions. It takes away from the programmer the need to program differently for different underlying hardware.</p>
</div>
</div>
<div id="outline-container-headline-7" class="outline-3">
<h3 id="headline-7">
Loop Unrolling&#xa0;&#xa0;&#xa0;<span class="tags"><span class="tag-technique">technique</span></span>
</h3>
<div id="outline-text-headline-7" class="outline-text-3">
<p>Do more in a single loop - because every loop has an overhead, and a single loop may not optimally utilise all the resources that are reserved for that round.</p>
</div>
</div>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
Data prefetching&#xa0;&#xa0;&#xa0;<span class="tags"><span class="tag-technique">technique</span></span>
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<p>Loading data into cache before it is needed, so wait times are reduced when actually operating on the data.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-9" class="outline-2">
<h2 id="headline-9">
ARM Neon
</h2>
<div id="outline-text-headline-9" class="outline-text-2">
<p>The NEON register bank consists of <strong>32 64-bit registers</strong>. Refer <a href="https://developer.arm.com/documentation/dht0002/a/Introducing-NEON/NEON-architecture-overview/NEON-registers">this</a> link.
The NEON unit can view the same register bank as</p>
<ul>
<li>sixteen 128-bit quadword registers, Q0-Q15</li>
<li>thirty-two 64-bit doubleword registers, D0-D31</li>
</ul>
<p>The <strong>Q</strong> and <strong>D</strong> prefixes indicate what view is in use.</p>
<p>
An example program to add two vectors</p>
<div class="src src-c">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;arm_neon.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">add_vectors</span><span class="p">(</span><span class="kt">int32_t</span><span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int32_t</span><span class="o">*</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int32_t</span><span class="o">*</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int32x4_t</span> <span class="n">va</span> <span class="o">=</span> <span class="nf">vld1q_s32</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int32x4_t</span> <span class="n">vb</span> <span class="o">=</span> <span class="nf">vld1q_s32</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int32x4_t</span> <span class="n">vc</span> <span class="o">=</span> <span class="nf">vaddq_s32</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">vb</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">vst1q_s32</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">vc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<p>
The function name <span style="text-decoration: underline;">vld1q_s32</span> is a mnemonic.</p>
<dl>
<dt>
v
</dt>
<dd>vector operation</dd>
<dt>
ld1
</dt>
<dd>load 1 vector</dd>
<dt>
q
</dt>
<dd>quad word operation. Uses 128-bit register</dd>
<dt>
s32
</dt>
<dd>32-bit signed integer values</dd>
</dl>
<p>Other function names (like <strong>vst1q_s32</strong> - to store) can be similarly broken down. The type int32x4_t denotes 4 32-bit integers.</p>
<p>
While <span style="text-decoration: underline;">ld1</span> denotes loading of 1 vector, <span style="text-decoration: underline;">ld2</span>, <span style="text-decoration: underline;">ld3</span> and <span style="text-decoration: underline;">ld4</span>, while loading 2, 3 and 4 vectors respectively, do so in an <strong>interleaved</strong> manner. So, if you are looking to sequentially load vectors, use <strong>vld1q_s32</strong> (or appropriate for different types) multiple times. Interleaving is useful for many use-cases and hence the interleaving load routines exist to support them.</p>
</div>
</div>
<div id="outline-container-headline-10" class="outline-2">
<h2 id="headline-10">
Metal
</h2>
<div id="outline-text-headline-10" class="outline-text-2">
<p>Knowledge of the fundamentals of GPU programming will help substantially while programming with the Metal APIs. Here are the key things to keep in mind when using Metal, vis-a-vis standard systems programming in a language like C.</p>
<div id="outline-container-headline-11" class="outline-3">
<h3 id="headline-11">
Terms/Concepts
</h3>
<div id="outline-text-headline-11" class="outline-text-3">
<dl>
<dt>
Device (MTLDevice)
</dt>
<dd>Awareness of the device you&#39;ll be using to program is key to the code we write</dd>
<dt>
Command Queue (MTLCommandQueue)
</dt>
<dd>Commands (executable logic) need to be ordered and executed using this component</dd>
<dt>
Command Buffer (MTLCommandBuffer)
</dt>
<dd>A space you will manage, where the commands to be executed on the GPUs are encoded and stored</dd>
<dt>
?
</dt>
<dd>
<p>Command Encoders</p>
<dl>
<dt>
Render Command Encoder (MTLRenderCommandEncoder)
</dt>
<dd>Encodes rendering commands</dd>
<dt>
Compute Command Encoder (MTLComputeCommandEncoder)
</dt>
<dd>Encodes computing commands for GPGPU programming</dd>
<dt>
Blit Command Encoder (MTLBlitCommandEncoder)
</dt>
<dd>Encodes commands for copying and managing resources</dd>
</dl>
</dd>
<dt>
?
</dt>
<dd>
<p>Pipeline State</p>
<dl>
<dt>
Render Pipeline State (MTLRenderPipelineState)
</dt>
<dd>Defines configurations for rendering operations</dd>
<dt>
Compute Pipeline State (MTLComputePipelineState)
</dt>
<dd>Defines configurations for compute operations</dd>
</dl>
</dd>
<dt>
Shaders
</dt>
<dd>
<p>Programs written in the Metal Shading Language (MSL)</p>
<dl>
<dt>
Vertex Shader
</dt>
<dd>Processes vertices</dd>
<dt>
Fragment Shader
</dt>
<dd>Processes each fragment (pixel)</dd>
<dt>
Compute Shader
</dt>
<dd>General purpose computation</dd>
</dl>
</dd>
<dt>
Buffers (MTLBuffer)
</dt>
<dd>Memory storage for data-types accessible by the GPU</dd>
<dt>
Textures (MTLTexture)
</dt>
<dd>Image data used in rendering or computing</dd>
<dt>
Libraries (MTLLibrary)
</dt>
<dd>Collections of shader functions that can be linked into pipeline states</dd>
</dl>
<p>Typically, the following steps are executed in a full-fledged computation on the GPU</p>
<ol>
<li>Initialization - create a device reference in code</li>
<li>Command queue creation</li>
<li>Buffer creation</li>
<li>Loading and compiling shaders</li>
<li>Creating pipeline states - can be for render or compute</li>
<li>Encoding commands - again, for render or compute</li>
<li>Submitting command buffers</li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-12" class="outline-2">
<h2 id="headline-12">
<a href="https://developer.apple.com/documentation/accelerate">Accelerate</a>
</h2>
<div id="outline-text-headline-12" class="outline-text-2">
<p>
Accelerate abstracts programming at a higher level for various application areas, like scientific computing, machine learning, image processing and such. It enables a more convenient way to implement logic for computationally intensive tasks, without having to write code conditioned on the hardware differences. It attempts to provide high performance at low energy consumption by using the hardware instructions well.</p>
<p>
The key components and uses of the Accelerate framework are</p>
<ul>
<li>
<p>Vector Digital Signal Processing</p>
<ul>
<li>Provides functions for various DSP tasks like convolution, correlation, Fourier transforms</li>
<li>It is optimised for both scalar and vector operations</li>
</ul>
</li>
<li>
<p>Image Processing</p>
<ul>
<li>Optimised image processing routines, including geometric tranformations</li>
</ul>
</li>
<li>
<p>Linear Algebra Library</p>
<ul>
<li>BLAS (Basic Linear Algebra Subprograms)</li>
<li>LAPACK (Linear Algebra Package)</li>
</ul>
</li>
<li>Basic Neural Network Subroutines (BNNS)</li>
<li>Quadrature - Efficient routines for approximating the definite integrals of one-dimensional functions.</li>
</ul>
<p>Here&#39;s a sample piece of self-contained code to show how straightforward it is to use Accelerate.</p>
<div class="src src-c">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Accelerate/Accelerate.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>  <span class="c1">// number of intervals
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="n">M_PI</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Create arrays for x values and sin(x) values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">double</span> <span class="n">x</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Generate x values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">vDSP_vrampD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Compute sin(x) for each x
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">vvsin</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Compute the sum of y values (excluding first and last)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">double</span> <span class="n">sum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">vDSP_sveD</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sum</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Add half of first and last y values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sum</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Multiply by h to get the final result
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">double</span> <span class="n">result</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">sum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Approximate integral of sin(x) from 0 to pi using Accelerate: %f</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Exact result should be 2.0</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<p>
Compile the above as follows</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">clang -framework Accelerate filename.c <span class="c1"># assuming code saved in filename.c</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-13" class="outline-2">
<h2 id="headline-13">
Acknowledgements
</h2>
<div id="outline-text-headline-13" class="outline-text-2">
<p><a href="https://chat.openai.com/">ChatGPT</a> was used extensively over extended periods, apart from reading the documents and other searches. But ChatGPT (and for some purposes, <a href="https://claude.ai/">Claude</a> when ChatGPT struggled) was extremely helpful, using it in a conversational style, with multiple rounds of diving deeper and clarifying.</p>
</div>
</div>

            </div>
        </article></main>
</div>

<footer class="footer">
    <small class="footer_copyright">
        Â© 2025 Ravindra R. Jaju.
        
    </small>
</footer>


<div class="fixed-social-icons">
    <a href="https://github.com/jaju" target="_blank" rel="noopener noreferrer me"
       title="GitHub" class="social-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
    </a>
    <a href="https://x.com/jaju" target="_blank" rel="noopener noreferrer me"
       title="X (Twitter)" class="social-icon">
        <svg viewBox="0 0 1200 1227" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path
        d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z"/>
</svg>
    </a>
</div>







    
    <script src="https://example.org/js/main.min.4ee188e1744c19816e95a540b2650ed9f033ea0371e74eac8e717355cfca8741.js" integrity="sha256-TuGI4XRMGYFulaVAsmUO2fAz6gNx506sjnFzVc/Kh0E="></script>

    

</body>
</html>
